<div class="scanner">
  <!-- Aviso de HTTPS -->
  <div *ngIf="insecure()" class="err">
    Este site precisa estar em <strong>HTTPS</strong> (ou <code>localhost</code>) para usar a câmera.
  </div>

  <!-- Aviso de navegador embutido -->
  <div *ngIf="inApp()" class="warn">
    O navegador do app (WhatsApp/Instagram) pode bloquear a câmera.
    <div class="row" style="margin-top:8px; gap:8px;">
      <a mat-stroked-button color="primary"
         [href]="loc.origin + loc.pathname"
         target="_blank" rel="noopener">
        Abrir no navegador
      </a>
      <button mat-stroked-button color="accent" (click)="forceStart()">Tentar mesmo assim</button>
    </div>
  </div>

  <video #preview playsinline muted style="width:100%;max-width:480px;border-radius:8px;"></video>

  <div class="actions" *ngIf="!started(); else running" style="margin-top:12px;">
    <button mat-flat-button color="primary" (click)="start()">Ligar câmera</button>
  </div>

  <ng-template #running>
    <p style="margin:8px 0;">Aponte para o QR</p>
    <button mat-stroked-button color="warn" (click)="stop()">Parar</button>
  </ng-template>
</div>
